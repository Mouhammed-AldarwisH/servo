<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تحكم بالسيرفو (MQTT)</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg1:#0f172a;--bg2:#0b3b53;--accent1:#ff7aa2;--accent2:#6be7ff;}
    body{
      height:100vh;margin:0;font-family:'Tajawal',sans-serif;direction:rtl;
      background:linear-gradient(120deg,var(--bg1),var(--bg2));
      display:flex;align-items:center;justify-content:center;flex-direction:column;color:white;
    }
    .pulse-btn{
      width:180px;height:180px;border-radius:50%;border:none;cursor:pointer;
      background:linear-gradient(135deg,var(--accent1),var(--accent2));
      color:#02151a;font-size:20px;font-weight:bold;
      box-shadow:0 0 20px rgba(255,255,255,0.1);
      transition:transform .2s ease,opacity .2s ease;
    }
    .pulse-btn:active{transform:scale(0.95);}
    .hint{margin-top:20px;opacity:0.8;}
  </style>
</head>
<body>
  <button id="btnSweep" class="pulse-btn">تشغيل السيرفو</button>
  <div class="hint">لا يمكن الضغط أكثر من مرة كل 10 ثوانٍ</div>

  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <script>
    const btnSweep = document.getElementById('btnSweep');

    // بيانات حسابك الجديد
    const serverUrl = 'wss://1163ef3a8e254ba9b3d6ffb7a7d90bf0.s1.eu.hivemq.cloud';
    const username  = 'hivemq.webclient.1762781150516';
    const password  = 'JG*c>5?6RpHIAdm$98kx';
    const topic     = '/commands/device_servo';

    let client=null, canPress=true;

    function connectMQTT(){
      if(client) try{client.end();}catch(e){}
      client = mqtt.connect(serverUrl,{username,password,reconnectPeriod:2000});
    }

    function disableButtonTemporarily(){
      canPress=false;
      btnSweep.style.opacity='0.5';
      btnSweep.style.pointerEvents='none';
      let count=10;
      const txt=btnSweep.textContent;
      const timer=setInterval(()=>{
        count--;
        btnSweep.textContent = count>0 ? `انتظر ${count} ثواني...` : txt;
        if(count<=0){
          clearInterval(timer);
          btnSweep.style.opacity='1';
          btnSweep.style.pointerEvents='auto';
          canPress=true;
        }
      },1000);
    }

    btnSweep.addEventListener('click',()=>{
      if(!canPress) return;
      disableButtonTemporarily();

      const payload='sweep';
      if(!client||client.disconnected) connectMQTT();

      // إرسال أمر واحد مؤقت (بدون retain)
    client.publish(topic, payload, { qos: 1, retain: true });

      btnSweep.animate([{transform:'scale(0.95)'},{transform:'scale(1)'}],{duration:160});
    });

    connectMQTT();
  </script>
</body>
</html>


